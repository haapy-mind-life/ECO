FMW 아키텍처 드라이버 (2025-10-31 기준)
> 문서 목적: 본 문서는 FMW 프로젝트의 PoC 완료 및 1차 롤아웃(20명) 단계를 기준으로, 모든 이해관계자(아키텍트, 운영, 보안, 사용자, 관리자)의 관점을 반영하여 시스템의 설계를 이끄는 핵심 **아키텍처 드라이버(Architecture Drivers)**를 정의합니다.
> 핵심 상태: PoC(3명) 성공, 1차 롤아웃(내부 팀 20명, Windows 환경) 준비 완료.
> 
1. 시스템 미션 및 컨텍스트
 * 미션: 분산된 정책/피처 상태 정보를 내부 사용자에게 빠르고 안정적으로 제공하여, 데이터 기반의 신속한 의사결정을 지원하고 '탐색 비용'을 제거한다.
 * 핵심 사용자 (Phase 1): 1차 사용자 (팀 동료 20명)
 * 핵심 사용자 (Phase 2): 2차 사용자 (그룹 사용자)
 * 컨텍스트: 사내망, Windows Server OS, Nginx, Django, Streamlit, Postgres
2. 아키텍처 원칙 (Principles)
다음은 1차 롤아웃의 성공을 이끄는 핵심 설계 원칙입니다.
 * 스냅샷 우선 (Snapshot First) — 성능/복원력
   * UI(Streamlit)는 DB 실시간 쿼리 대신, 사전 생성된 스냅샷 파일(records.csv 등)을 우선 로드합니다.
   * (이유) 1차 사용자에게 P95 < 5초의 압도적인 조회 속도를 제공하고, 백엔드 장애 시에도 마지막 스냅샷으로 서비스를 지속(장애 격리)하기 위함입니다.
 * 보안 2중 경계 (Dual-Layer Security) — 보안
   * Nginx에서 IP Allowlist로 1차 차단하고, 내부 앱(Django/Streamlit)은 루프백(127.0.0.1) 바인딩으로 외부 직접 접근을 원천 차단합니다.
   * (이유) 1차 롤아웃 단계에서 가장 신속하고 확실하게 네트워크 경계를 방어합니다.
 * 멱등성 및 정규화 (Idempotency & Normalization) — 무결성
   * identity_hash UNIQUE 키를 통해 데이터 파이프라인의 멱등성을 보장합니다.
   * (이유) 데이터 중복을 방지하고 신뢰할 수 있는 단일 진실 공급원(SSOT)을 구축하기 위함입니다.
 * 운영 자동화 (Automated Operations) — 운영성
   * 모든 SW(Django/Streamlit)는 cmd 수동 실행이 아닌, NSSM 등을 통해 Windows 서비스로 등록되어야 합니다.
   * (이유) 관리자(개발팀)의 운영 부담(일 30분 이내)을 최소화하고, 서버 재부팅 시 자동 시작 및 장애 시 자동 복구를 보장합니다.
 * 단계적 확장 (Phased Rollout) — 전략
   * (Phase 1) 20명 대상 '가치' 증명 \rightarrow (Phase 2) 200명+ 대상 '보안/규모' 증명.
   * (이유) 보안 담당자와 2차 사용자의 높은 요구사항(SSO/RBAC)을 충족하기 전에, 1차 사용자를 통해 시스템의 핵심 가치를 먼저 입증합니다.
3. 설계 제약 (Constraints)
다음은 1차 롤아웃 시 반드시 준수해야 하는 기술적 제약 조건입니다.
 * 플랫폼: 모든 서버 및 1차 사용자 클라이언트는 Windows OS입니다.
 * 데이터베이스: 20명의 동시 접속을 위해 SQLite 사용을 금지하며, 반드시 Postgres (또는 동급의 서버형 DB)를 사용해야 합니다.
 * 프로세스: 모든 서비스는 Windows 정식 서비스로 등록되어야 합니다. (SW 전문가 조언)
 * 네트워크: 사내망 전용이며 외부망 접근은 허용되지 않습니다. Nginx를 통한 IP Allowlist는 필수입니다.
 * 인증 (Phase 1): SSO 미적용. 접근 제어는 오직 Nginx IP Allowlist에 의존합니다. (보안 담당자 인지 사항)
 * 인가 (Phase 1): RBAC 미적용. 1차 사용자 20명은 모든 데이터를 조회 가능합니다.
4. 품질 속성 및 적합 기준 (Quality Goals)
각 관점에서 바라보는 시스템의 성공 기준(NFR)은 다음과 같습니다.
 * 성능 (1차 사용자 관점)
   * 홈(Home) 화면 평균 로딩 < 1초
   * 주요 데이터 조회 P95 < 5초
   * (기준) 이 기준 실패 시, 1차 사용자는 "느린 툴"로 인식하고 이탈합니다.
 * 사용성 (관리자/고과권자 관점)
   * 1차 사용자 주간 활성(WAU) \ge 70%
   * (기준) WAU 70% 달성 시, 이 프로젝트의 ROI가 1차 증명된 것으로 간주합니다.
 * 신뢰성 (운영 관점)
   * 일일 동기화 성공률 \ge 98%
   * Windows 서비스 비정상 종료 시 자동 재시작
   * (기준) 데이터가 신뢰(Trust)를 잃으면 서비스는 실패합니다.
 * 보안 (보안 담당자 관점 - Phase 1)
   * 비허용 IP의 접근 시도 0건 (Nginx 로그 기준)
   * 사용자(20명)가 관리자 API(api/dev) 접근 0건
   * (기준) 1차 롤아웃 기간 동안 최소한의 네트워크 경계를 준수합니다.
 * 유지보수성 (관리자/SW 전문가 관점)
   * 관리자 3명의 일일 운영 부담 \le 30분 (평균)
   * 배포는 자동화된 스크립트(deploy.bat)로 수행되어야 합니다.
   * (기준) 운영 부담이 30분을 초과하면 관리자의 핵심 업무(개발) 리소스가 잠식됩니다.
 * 확장성 (아키텍트/SW 전문가 관점)
   * (Phase 1) 20명 동시 사용자(Streamlit 세션 메모리)를 Windows Server 사양 내에서 안정적으로 처리해야 합니다.
   * (Phase 2) 200명+ 규모 확장을 위해 Streamlit 아키텍처는 폐기되고 API + Web 구조로 전환되어야 합니다.
5. 핵심 리스크 및 대응 (Risks & Mitigations)
| 리스크 (관점) | 설명 | 대응 전략 |
|---|---|---|
| 서비스 중단 (운영) | Windows 서버 재부팅 또는 관리자 로그아웃 시 서비스가 중단됨. | NSSM 등을 사용해 모든 프로세스를 Windows 정식 서비스로 등록 (필수 조치) |
| DB 잠금 (아키텍트) | 20명 사용자가 동시 접속 시 SQLite 파일 잠금으로 서비스 장애 발생. | 1차 롤아웃 전 Postgres로 DB 전환 (필수 조치) |
| UI 중단 (아키텍트) | 관리자의 스냅샷 쓰기(Write)와 1차 사용자의 읽기(Read)가 충돌 (파일 잠금). | 스냅샷 생성 로직을 **'임시 파일 생성 \rightarrow 원자적 교체(Atomic Rename)'**로 구현 |
| 데이터 유실 (운영) | 서버 하드웨어 장애 시 DB 및 스냅샷 데이터 유실. | Windows '작업 스케줄러' 및 pg_dump를 이용한 일일 자동화 백업 구성 (필수 조치) |
| 규모 확장 실패 (SW 전문가) | 2차 롤아웃(200명+) 시 Streamlit의 메모리 한계로 서비스 불가. | (Phase 2) 아키텍처를 **API + Web(React/Vue)**로 전면 전환 (로드맵) |
| 보안 승인 실패 (보안 담당자) | 2차 롤아웃 시 보안팀 요구(SSO/RBAC) 미충족으로 확장 불가. | (Phase 2) SSO/RBAC를 로드맵에 반영하고 보안팀과 공식 협의 (로드맵) |
